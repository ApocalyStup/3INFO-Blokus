#include "blokus.hpp"
#include <iomanip>
#include <string>

const blokus::Move blokus::PASS;

blokus::blokus() {
    corner[0].set(INIT_SQUARE0);
    corner[1].set(INIT_SQUARE1);
}

std::vector<uint8_t> blokus::get_bits(const std::bitset<SQUARES>& b) {
    std::vector<uint8_t> res;
    for (int i = 0; i < SQUARES; i++) {
        if (b[i]) res.push_back(i);
    }
    return res;
}

std::vector<blokus::Move> blokus::get_moves() const {    
    uint32_t pieces = this->pieces[player];
    if (pieces == ALL_PIECES) {
        return { PASS };
    }
    std::vector<uint8_t> corners = get_bits(corner[player]);
    int ncorners = corners.size();
    if (ncorners == 0) {
        return { PASS };
    }
    const std::bitset<SQUARES>& border = this->border[player];
    std::vector<Move> moves;
    for (int p = PATTERNS-1; p >=0; p--) {
        const blokus::pattern& pattern = patterns[p];                
        if (pieces & (1 << pattern.piece)) {
            continue;
        }
        std::bitset<SQUARES> seen;
        for (int i = 0; i < ncorners; i++) {
            int corner = corners[i];
            for (int j = 0; j < CELLS; j++) {
                int sq = pattern_squares[p][corner][j];
                if (sq < 0) {
                    break;
                }
                if (seen[sq]) {
                    continue;
                }                
                seen.set(sq);
                const placement& placement = placements[p][sq];
                if (!placement.valid || (placement.filled & border).any()) {
                    continue;
                }
                moves.emplace_back(p, sq);
            }
        }
    }
    if (moves.size()) {
        return moves;
    }
    else {
        return { PASS };
    }
}

blokus::Move blokus::random_move(std::mt19937& engine) {
    uint32_t pieces = this->pieces[player];
    if (pieces == ALL_PIECES) {
        return PASS;
    }
    std::vector<uint8_t> corners = get_bits(corner[player]);
    int ncorners = corners.size();
    if (ncorners == 0) {
        return PASS;
    }
    std::uniform_int_distribution<uint8_t> dpatterns(0, PATTERNS - 1);
    std::uniform_int_distribution<int> dcorners(0, ncorners - 1);
    const std::bitset<SQUARES>& border = this->border[player];
    for (int i = 0; i < 200; i++) {
        uint8_t p = dpatterns(engine);
        if (pieces & (1 << patterns[p].piece)) {
            continue;
        }
        int corner = corners[dcorners(engine)];
        int ncells = 0;
        for (int i = 0; i < CELLS; i++) {
            ncells += pattern_squares[p][corner][i] >= 0;
        }
        if (ncells == 0) {
            continue;
        }
        std::uniform_int_distribution<int> dcells(0, ncells - 1);
        int j = dcells(engine);
        uint8_t sq = pattern_squares[p][corner][j];
        const placement& placement = placements[p][sq]; 
        if (!placement.valid || (placement.filled & border).any()) {
            continue;
        }
        return {p, sq};
    }
    std::vector<Move> moves = get_moves();
    int count = moves.size();
    if (count == 0) {
        return PASS;
    }
    std::uniform_int_distribution<int> dmoves(0, count - 1);
    int index = dmoves(engine);
    return moves[index];
}

int blokus::heuristic() const {
    int scores[PLAYERS];
    for (int i = 0; i < PLAYERS; i++) {
        int filled = this->filled[i].count();
        int border = this->border[i].count();
        int corner = this->corner[i].count();
        int score = filled * 10 - border + corner * 10;
        scores[i] = score;
    }
    int others = 0;
    for (int i = 0; i < PLAYERS; i++) {
        if (i != player) {
            others += scores[i];
        }
    }
    return scores[player] - others * 10;
}

bool blokus::end_of_game() const {    
    for (int i = 0; i < PLAYERS; i++) {
        if (!passes[i]) {
            return false;
        }
    }
    return true;
}

int blokus::current_player() const {
    return player;
}

int blokus::value(int player) const {
    int res = score[player];
    for (int i = 0; i < PLAYERS; i++) {
        if (i == player) continue;
        res -= score[i];
    }
    return res; 
}
    
int blokus::value_for_current_player() const {
    return value(player);
}

bool blokus::won(int player) const {
    return value(player) > 0;
} 

void blokus::make_move(const Move& m) {
    if (m == PASS) {
        passes[player] = true;       
    } else {
        const placement& placement = placements[m.pattern][m.square];        
        filled[player] |= placement.filled;
        border[player] |= placement.border;
        corner[player] |= placement.corner;
        corner[player] &= ~border[player];
        for (int i = 0; i < PLAYERS; i++) {
            if (i == player) {
                continue;
            }
            border[i] |= placement.filled;
            corner[i] &= ~border[i];
        }
        const pattern& pattern = patterns[m.pattern];
        score[player] += pattern.cells;
        pieces[player] |= 1 << pattern.piece;
    }    
    player = (player + 1) % PLAYERS;
}

void blokus::playout(std::mt19937& engine) {
    while (!end_of_game()) {
        std::vector<Move> moves = get_moves();
        Move move;
        if (moves.size() == 0) {
            passes[player] = true;
            move = PASS;                        
        } else {
            std::uniform_int_distribution<int> dmoves(0, moves.size() - 1);
            move = moves[dmoves(engine)];
        }        
        make_move(move);
    }
}

std::ostream& operator<<(std::ostream& os, const blokus& b) {
    os << "   ";
    for (int x = 0; x < blokus::WIDTH; x++) {
        os << std::setw(2) << std::left << blokus::x_to_letter(x);
    }
    os << "\n";
    const std::string codes = "xo";
    for (int y = 0; y < blokus::HEIGHT; y++) {
        os << std::setw(3) << std::right << (std::to_string(y) + " ");
        for (int x = 0; x < blokus::WIDTH; x++) {
            int blank = 1;
            int sq = blokus::square(x, y);
            for (int i = 0; i < blokus::PLAYERS; i++) {                
                if (b.filled[i][sq]) {
                    os << codes[i % 2] << " ";
                    blank = 0;
                    break;
                }                
                if ((sq == blokus::INIT_SQUARE0 && i == 0) || 
                    (sq == blokus::INIT_SQUARE1 && i == 1)) {
                    os << "@ ";
                    blank = 0;
                    break;
                } 
            }
            if (blank) {
                os << ". ";
            }
        }
        os << '\n';
    }
    os << '\n';
    return os;
}

std::ostream& blokus::print_possible_moves(std::ostream& os, int number_by_row) const {
    const auto& moves = get_moves();
    const int n = moves.size();
    if (moves[0] == PASS) {
        os << "0: PASS\n";
        return os;
    }
    for (int k = 0; k < n; k += number_by_row) {
        for (int i = k; i < n && i < k + number_by_row; i++) {
            auto sq = moves[i].square;
            int x = sq % WIDTH;
            int y = sq / WIDTH;
            os << std::setw(12) << std::left 
               << (std::to_string(i) + ": (" + x_to_letter(x) + "," + std::to_string(y) + ")");
        }
        os << "\n";        
        for (int y = 0; y < 7; y++) {
            for (int i = k; i < n && i < k + number_by_row; i++) {
                auto p = moves[i].pattern;
                std::string res;
                for (int x = 0; x < 7; x++) {
                    res += patterns[p].data[y][x] == 1 ? "#" : ".";
                }
                os << std::setw(12) << std::left << res;
            }
            os << '\n';
        }        
    }                               
    return os;
}

std::istream& operator>>(std::istream& is, blokus::Move& m) {
    int x, y, piece;
    is >> x >> y >> piece;
    m.square = blokus::square(x, y); 
    m.pattern = piece;
    return is;
}

bool operator==(const blokus::Move& m1, const blokus::Move& m2) {
    return m1.pattern == m2.pattern && m1.square == m2.square;
}

std::ostream& operator<<(std::ostream& os, const blokus::Move& m) {
    if (m == blokus::PASS) {
        os << "PASS";
        return os;
    }
    auto sq = m.square;
    int x = sq % blokus::WIDTH;
    int y = sq / blokus::WIDTH;
    //os << std::setw(12) << std::left 
    //    << ("(" + std::to_string(x) + "," + std::to_string(y) + ")");
    os << "(" << blokus::x_to_letter(x) << "," << y << "): ";
    const auto& p = blokus::patterns[m.pattern];
    os << p.name << " " << p.rotation;
    /*for (int y = 0; y < 7; y++) {             
        for (int x = 0; x < 7; x++) {
            os << (p.data[y][x] == 1 ? "#" : ".");
        }
        os << '\n';
    }*/
    return os;
}

const std::vector<blokus::pattern> blokus::patterns {
    { 0, 0, 1, 1, 1,  "1", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 0, 1, 1, 1, 1,  "1", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 0, 2, 1, 1, 1,  "1", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 0, 3, 1, 1, 1,  "1", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 0, 4, 1, 1, 1,  "1", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 0, 5, 1, 1, 1,  "1", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 0, 6, 1, 1, 1,  "1", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 0, 7, 1, 1, 1,  "1", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    
    { 1, 0, 2, 1, 2,  "2", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 1, 1, 1, 2, 2,  "2", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 1, 2, 2, 1, 2,  "2", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 1, 3, 1, 2, 2,  "2", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 1, 4, 2, 1, 2,  "2", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 1, 5, 1, 2, 2,  "2", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 1, 6, 2, 1, 2,  "2", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 1, 7, 1, 2, 2,  "2", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},

    { 2, 0, 2, 2, 3, "V3", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 2, 1, 2, 2, 3, "V3", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 2, 2, 2, 2, 3, "V3", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 2, 3, 2, 2, 3, "V3", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 2, 4, 2, 2, 3, "V3", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 2, 5, 2, 2, 3, "V3", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 2, 6, 2, 2, 3, "V3", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 2, 7, 2, 2, 3, "V3", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    
    { 3, 0, 3, 1, 3, "I3", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0},
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 3, 1, 1, 3, 3, "I3", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 3, 2, 3, 1, 3, "I3", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0},
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 3, 3, 1, 3, 3, "I3", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 3, 4, 3, 1, 3, "I3", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0},
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 3, 5, 1, 3, 3, "I3", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 3, 6, 3, 1, 3, "I3", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0},
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 3, 7, 1, 3, 3, "I3", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    
    { 4, 0, 2, 3, 4, "Z4", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 4, 1, 3, 2, 4, "Z4", {{0, 3, 2, 2, 3, 0, 0},
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 4, 2, 2, 3, 4, "Z4", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 4, 3, 3, 2, 4, "Z4", {{0, 3, 2, 2, 3, 0, 0},
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 4, 4, 2, 3, 4, "Z4", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 4, 5, 3, 2, 4, "Z4", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {0, 3, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 4, 6, 2, 3, 4, "Z4", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 4, 7, 3, 2, 4, "Z4", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {0, 3, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    
    { 5, 0, 2, 2, 4,  "O", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 5, 1, 2, 2, 4,  "O", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 5, 2, 2, 2, 4,  "O", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 5, 3, 2, 2, 4,  "O", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 5, 4, 2, 2, 4,  "O", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 5, 5, 2, 2, 4,  "O", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 5, 6, 2, 2, 4,  "O", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 5, 7, 2, 2, 4,  "O", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},

    { 6, 0, 2, 3, 4, "T4", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 6, 1, 3, 2, 4, "T4", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},              
    { 6, 2, 2, 3, 4, "T4", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 6, 3, 3, 2, 4, "T4", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 6, 4, 2, 3, 4, "T4", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 6, 5, 3, 2, 4, "T4", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 6, 6, 2, 3, 4, "T4", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 6, 7, 3, 2, 4, "T4", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},   

    { 7, 0, 3, 3, 5, "V5", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 7, 1, 3, 3, 5, "V5", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 7, 2, 3, 3, 5, "V5", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {0, 0, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 7, 3, 3, 3, 5, "V5", {{0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 2, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 7, 4, 3, 3, 5, "V5", {{0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 2, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 7, 5, 3, 3, 5, "V5", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 7, 6, 3, 3, 5, "V5", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 7, 7, 3, 3, 5, "V5", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {0, 0, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},

    { 8, 0, 2, 3, 5,  "P", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 8, 1, 3, 2, 5,  "P", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 8, 2, 2, 3, 5,  "P", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 8, 3, 3, 2, 5,  "P", {{0, 3, 2, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 8, 4, 2, 3, 5,  "P", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 8, 5, 3, 2, 5,  "P", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 8, 6, 2, 3, 5,  "P", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 8, 7, 3, 2, 5,  "P", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {0, 3, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},

    { 9, 0, 2, 3, 5,  "U", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 9, 1, 3, 2, 5,  "U", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 1, 2, 0, 0}, 
                            {3, 2, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 9, 2, 2, 3, 5,  "U", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0},
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 9, 3, 3, 2, 5,  "U", {{3, 2, 3, 2, 3, 0, 0}, 
                            {2, 1, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 9, 4, 2, 3, 5,  "U", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0},
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 9, 5, 3, 2, 5,  "U", {{3, 2, 3, 2, 3, 0, 0}, 
                            {2, 1, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 9, 6, 2, 3, 5,  "U", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    { 9, 7, 3, 2, 5,  "U", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 1, 2, 0, 0}, 
                            {3, 2, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},

    {10, 0, 3, 3, 5,  "W", {{3, 2, 2, 3, 0, 0, 0},
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {0, 3, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {10, 1, 3, 3, 5,  "W", {{0, 0, 3, 2, 3, 0, 0}, 
                            {0, 3, 2, 1, 2, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {10, 2, 3, 3, 5,  "W", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {0, 3, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {10, 3, 3, 3, 5,  "W", {{0, 3, 2, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {10, 4, 3, 3, 5,  "W", {{0, 3, 2, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {10, 5, 3, 3, 5,  "W", {{3, 2, 2, 3, 0, 0, 0},
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {0, 3, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {10, 6, 3, 3, 5,  "W", {{0, 0, 3, 2, 3, 0, 0}, 
                            {0, 3, 2, 1, 2, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {10, 7, 3, 3, 5,  "W", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {0, 3, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},

    {11, 0, 3, 3, 5,  "F", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {11, 1, 3, 3, 5,  "F", {{0, 3, 2, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {11, 2, 3, 3, 5,  "F", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {11, 3, 3, 3, 5,  "F", {{0, 3, 2, 3, 0, 0, 0}, 
                            {0, 2, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {11, 4, 3, 3, 5,  "F", {{0, 0, 3, 2, 3, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {11, 5, 3, 3, 5,  "F", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0},
                            {0, 3, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {11, 6, 3, 3, 5,  "F", {{0, 3, 2, 3, 0, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {11, 7, 3, 3, 5,  "F", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 3, 0, 0}, 
                            {3, 2, 1, 1, 2, 0, 0}, 
                            {0, 2, 1, 2, 3, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},

    {12, 0, 3, 3, 5, "Z5", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {0, 2, 1, 1, 2, 0, 0}, 
                            {0, 3, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {12, 1, 3, 3, 5, "Z5", {{0, 0, 3, 2, 3, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {12, 2, 3, 3, 5, "Z5", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {0, 2, 1, 1, 2, 0, 0}, 
                            {0, 3, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {12, 3, 3, 3, 5, "Z5", {{0, 0, 3, 2, 3, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {12, 4, 3, 3, 5, "Z5", {{0, 3, 2, 2, 3, 0, 0}, 
                            {0, 2, 1, 1, 2, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {12, 5, 3, 3, 5, "Z5", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {12, 6, 3, 3, 5, "Z5", {{0, 3, 2, 2, 3, 0, 0}, 
                            {0, 2, 1, 1, 2, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {12, 7, 3, 3, 5, "Z5", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    
    {13, 0, 2, 3, 4, "L4", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {13, 1, 3, 2, 4, "L4", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {13, 2, 2, 3, 4, "L4", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {0, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {13, 3, 3, 2, 4, "L4", {{0, 0, 3, 2, 3, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {13, 4, 2, 3, 4, "L4", {{0, 3, 2, 3, 0, 0, 0}, 
                            {0, 2, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {3, 2, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {13, 5, 3, 2, 4, "L4", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {13, 6, 2, 3, 4, "L4", {{3, 2, 2, 3, 0, 0, 0}, 
                            {2, 1, 1, 2, 0, 0, 0}, 
                            {2, 1, 2, 3, 0, 0, 0}, 
                            {2, 1, 2, 0, 0, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {13, 7, 3, 2, 4, "L4", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    
    {14, 0, 3, 3, 5, "T5", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {14, 1, 3, 3, 5, "T5", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {0, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {14, 2, 3, 3, 5, "T5", {{0, 0, 3, 2, 3, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {14, 3, 3, 3, 5, "T5", {{0, 3, 2, 3, 0, 0, 0}, 
                            {0, 2, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {14, 4, 3, 3, 5, "T5", {{0, 0, 3, 2, 3, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 1, 2, 0, 0}, 
                            {0, 0, 3, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {14, 5, 3, 3, 5, "T5", {{0, 3, 2, 3, 0, 0, 0}, 
                            {0, 2, 1, 2, 0, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 2, 2, 3, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {14, 6, 3, 3, 5, "T5", {{3, 2, 3, 0, 0, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {2, 1, 2, 2, 3, 0, 0}, 
                            {3, 2, 3, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
    {14, 7, 3, 3, 5, "T5", {{3, 2, 2, 2, 3, 0, 0}, 
                            {2, 1, 1, 1, 2, 0, 0}, 
                            {3, 2, 1, 2, 3, 0, 0}, 
                            {0, 2, 1, 2, 0, 0, 0}, 
                            {0, 3, 2, 3, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}, 
                            {0, 0, 0, 0, 0, 0, 0}}},
};

const std::vector<std::vector<std::vector<int>>> blokus::pattern_squares { 
    []{
        std::vector<std::vector<std::vector<int>>> pattern_squares(
            PATTERNS, std::vector<std::vector<int>>(SQUARES, std::vector<int>(CELLS, -1))
        );
        for (int p = 0; p < PATTERNS; p++) {
            const pattern& pattern = patterns[p];
            for (int sq = 0; sq < SQUARES; sq++) {                
                int x = sq % WIDTH;
                int y = sq / WIDTH;
                int index = 0;
                for (int dy = 0; dy < 7; dy++) {
                    for (int dx = 0; dx < 7; dx++) {
                        int t = pattern.data[dy][dx];
                        if (t != FILLED) {
                            continue;
                        }
                        int ax = x - dx + 1;
                        int ay = y - dy + 1;
                        if (ax < 0 || ay < 0 || ax >= WIDTH || ay >= HEIGHT) {
                            continue;
                        }
                        int bx = ax + pattern.width - 1;
                        int by = ay + pattern.height - 1;
                        if (bx < 0 || by < 0 || bx >= WIDTH || by >= HEIGHT) {
                            continue;
                        }
                        pattern_squares[p][sq][index++] = square(ax, ay);
                    }
                }
            }
        }        
        return pattern_squares;
    }()
};

const std::vector<std::vector<blokus::placement>> blokus::placements {
    []{
        auto init_placement = [](const pattern& pattern, int sq, placement& placement) {
            int x = sq % WIDTH;
            int y = sq / WIDTH;
            placement.valid = 1;
            placement.filled.reset();
            placement.border.reset();
            placement.corner.reset();
            for (int dy = 0; dy < 7; dy++) {
                for (int dx = 0; dx < 7; dx++) {
                    int t = pattern.data[dy][dx];
                    int tx = x + dx - 1;
                    int ty = y + dy - 1;
                    if (tx < 0 || ty < 0 || tx >= WIDTH || ty >= HEIGHT) {
                        if (t == FILLED) {
                            placement.valid = 0;
                            return;
                        }
                        continue;
                    }
                    int idx = square(tx, ty);
                    switch (t) {
                        case FILLED:
                            placement.filled.set(idx);
                            placement.border.set(idx);
                            break;
                        case BORDER:
                            placement.border.set(idx);
                            break;
                        case CORNER:
                            placement.corner.set(idx);
                            break;
                    }
                }
            }
        };
        std::vector<std::vector<blokus::placement>> placements(
            PATTERNS, std::vector<blokus::placement>(SQUARES)
        );
        for (int p = 0; p < PATTERNS; p++) {
            for (int s = 0; s < SQUARES; s++) {
                init_placement(patterns[p], s, placements[p][s]);
            }
        }
        return placements;
    }()
};

void blokus::maj_XY(int* x, int* y, int nb_rot, int nb_flip)
{
    switch (nb_rot)
    {
    case 0:
        if(nb_flip==1)
        {
            *x=*x-3;
            break;
        }
        else
        {
            break;
        }

    case 1:
        if(nb_flip==0)
        {
            *x=*x-3;
            break;
        }
        else
        {
            *x=*x-3;
            *y=*y-3;
            break;
        }

    case 2:
        if(nb_flip==0)
        {
            *y=*y-3;
            *x=*x-3;
            break;
        }
        else
        {
            *y=*y-3;
            break;
        }

    case 3:
        if(nb_flip==0)
        {
            *y=*y-3;
            break;
        }
        else
        {
            break;
        }
    }
}

void blokus::maj_XY2(int* x, int* y, int nb_rot, int nb_flip)
{
    switch (nb_rot)
    {
    case 0:
        if(nb_flip==1)
        {
            *x=*x+3;
            break;
        }
        else
        {
            break;
        }

    case 1:
        if(nb_flip==0)
        {
            *x=*x+3;
            break;
        }
        else
        {
            *x=*x+3;
            *y=*y+3;
            break;
        }

    case 2:
        if(nb_flip==0)
        {
            *y=*y+3;
            *x=*x+3;
            break;
        }
        else
        {
            *y=*y+3;
            break;
        }

    case 3:
        if(nb_flip==0)
        {
            *y=*y+3;
            break;
        }
        else
        {
            break;
        }
    }
}